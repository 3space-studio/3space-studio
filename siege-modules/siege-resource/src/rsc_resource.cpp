// TODO port from python code